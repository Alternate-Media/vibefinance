# üß† Backend Context

## Purpose
The backend is the "Source of Truth" for VibeFinance. it handles all business logic, financial calculations, Application-Level Encryption (ALE), and data aggregation.

## üõ†Ô∏è Stack Specifics
- **Language:** Python 3.12+
- **Framework:** FastAPI
- **ORM/Validation:** SQLModel (SQLAlchemy + Pydantic)
- **Database:** PostgreSQL 16+

## üìú Strict Rules
1. **Strict TDD:** Tests MUST be written *before* implementation.
2. **The "No Float" Policy:** `float` is FORBIDDEN for monetary values. Use `Decimal` exclusively.
2. **Explicit Typing:** Strict type hints are mandatory. No `Any`, `*args`, or `**kwargs` without strong justification.
3. **Fail Secure:** Default to "Deny" for all auth and permission checks.
4. **Dependency Quarantine:** Wrap 3rd-party libraries (e.g., encryption, external APIs) in a service layer.
5. **Micro-Files:** One Class = One File (e.g., `models/user.py`).
6. **Application-Level Encryption (ALE):** Sensitive data (PII, balances) must be encrypted before reaching the database.
7. **Append-Only State:** Historical financial data is immutable. Use soft deletes and audit trails.

## üèóÔ∏è Architecture
- **BFF (Backend-for-Frontend):** Provide aggregate "Summary" endpoints to minimize frontend network chatter.
- **Dependency Injection:** Use FastAPI `Depends` for DB sessions and configurations. No global state.
